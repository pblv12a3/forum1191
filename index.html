<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ForumsR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" type="image/png" href="favcon.png">
</head>
<body>

<header class="topbar">
  <a class="brandLink" href="index.html">
    <img class="brandLogo" src="favcon.png" alt="ForumsR">
    <span class="brandText">ForumsR</span>
  </a>
  <div class="topRight">
    <span id="userLabel"></span>
    <button id="btnLogout" class="hidden">Logout</button>
  </div>
</header>

<main class="container">

  <!-- PROFILE (only shown if user doesn't have username yet) -->
  <section id="profileCard" class="hidden">
    <h2>Create profile</h2>
    <input id="profileUsername" placeholder="Username (letters/numbers/._-)" />
    <input id="profilePhotoUrl" placeholder="Profile picture URL (optional https://...)" />
    <button id="btnSaveProfile">Save profile</button>
    <div id="profileMsg" class="muted"></div>
  </section>

  <!-- COMPOSER -->
  <section id="composerCard" class="hidden">
    <h2>New post</h2>
    <input id="postTitle" placeholder="Title" />
    <textarea id="postBody" placeholder="Text"></textarea>
    <input id="imageUrl" placeholder="Image URL (optional https://...)" />
    <input id="videoUrl" placeholder="Video URL (optional https://...)" />
    <button id="btnPublish">Publish</button>
    <div id="publishMsg" class="muted"></div>
  </section>

  <!-- FEED -->
  <section id="feed" class="hidden">
    <h2>Posts</h2>
    <div id="posts"></div>
  </section>

</main>

<!-- Reply dialog -->
<dialog id="replyDialog">
  <form method="dialog" class="dialogBox">
    <h3 id="replyToTitle">Reply</h3>
    <textarea id="replyText" placeholder="Write your reply..."></textarea>
    <div class="row">
      <button id="btnSendReply" type="button">Send reply</button>
      <button type="submit">Close</button>
    </div>
    <div id="replyMsg" class="muted"></div>
  </form>
</dialog>

<script type="module">
  // Crash fallback only for real crashes
  const shouldRedirect = (reason) => {
    const m = String(reason?.code || reason?.message || reason || "");
    if (m.includes("auth/")) return false;          // auth errors handled in UI / redirect to login
    if (m.includes("chrome-extension://")) return false;
    return true;
  };
  window.addEventListener("error", (e) => { if (shouldRedirect(e?.error || e?.message)) location.href = "uhoh.html"; });
  window.addEventListener("unhandledrejection", (e) => { if (shouldRedirect(e?.reason)) location.href = "uhoh.html"; });

  import "./app.js?v=1";
</script>
</body>
</html>


